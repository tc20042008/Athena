[
  "__builtin_let__",
  [
    [
      "ap_tpl_codegen",
      [
        "import",
        {
          "str": "ap_tpl_codegen"
        }
      ]
    ],
    [
      "___0",
      [
        "__builtin_list__"
      ]
    ],
    [
      "__init__",
      [
        "__builtin_identity__",
        [
          "lambda",
          [
            "self",
            "trivial_op_code_gen_class"
          ],
          [
            "__builtin_let__",
            [
              [
                "___1",
                [
                  "__builtin_getattr__",
                  "ap_tpl_codegen",
                  {
                    "str": "GeneratorClassFactory"
                  }
                ]
              ],
              [
                "___2",
                [
                  "___1"
                ]
              ],
              [
                "___3",
                [
                  "__builtin_setattr__",
                  "self",
                  {
                    "str": "class_factory"
                  }
                ]
              ],
              [
                "___4",
                [
                  "___3",
                  {
                    "str": "class_factory"
                  },
                  "___2"
                ]
              ],
              [
                "___5",
                [
                  "__builtin_getattr__",
                  "ap_tpl_codegen",
                  {
                    "str": "CudaLikeIrCodeGenCtx"
                  }
                ]
              ],
              [
                "___6",
                [
                  "__builtin_setattr__",
                  "self",
                  {
                    "str": "lir_code_gen_ctx_class"
                  }
                ]
              ],
              [
                "___7",
                [
                  "___6",
                  {
                    "str": "lir_code_gen_ctx_class"
                  },
                  "___5"
                ]
              ],
              [
                "___8",
                [
                  "__builtin_setattr__",
                  "self",
                  {
                    "str": "trivial_op_code_gen_class"
                  }
                ]
              ],
              [
                "___9",
                [
                  "___8",
                  {
                    "str": "trivial_op_code_gen_class"
                  },
                  "trivial_op_code_gen_class"
                ]
              ]
            ],
            [
              "__builtin_identity__",
              null
            ]
          ]
        ]
      ]
    ],
    [
      "___10",
      [
        "__builtin_getattr__",
        "__init__",
        {
          "str": "__function__"
        }
      ]
    ],
    [
      "___11",
      [
        "__builtin_list__",
        {
          "str": "__init__"
        },
        "___10"
      ]
    ],
    [
      "compile",
      [
        "__builtin_identity__",
        [
          "lambda",
          [
            "self",
            "dim0_karg",
            "input_karg",
            "output_karg"
          ],
          [
            "__builtin_let__",
            [
              [
                "___12",
                [
                  "__builtin_getattr__",
                  "dim0_karg",
                  {
                    "str": "value"
                  }
                ]
              ],
              [
                "dim0_value",
                [
                  "__builtin_identity__",
                  "___12"
                ]
              ],
              [
                "___13",
                [
                  "__builtin_getattr__",
                  "IndexTupleExpr",
                  {
                    "str": "Domain"
                  }
                ]
              ],
              [
                "___14",
                [
                  "__builtin_list__",
                  "dim0_value"
                ]
              ],
              [
                "___15",
                [
                  "___13",
                  "___14"
                ]
              ],
              [
                "loop_index_tuple_expr",
                [
                  "__builtin_identity__",
                  "___15"
                ]
              ],
              [
                "___16",
                [
                  "__builtin_getattr__",
                  "self",
                  {
                    "str": "trivial_op_code_gen_class"
                  }
                ]
              ],
              [
                "___17",
                [
                  "__builtin_getattr__",
                  "self",
                  {
                    "str": "class_factory"
                  }
                ]
              ],
              [
                "___18",
                [
                  "__builtin_list__",
                  {
                    "str": "class_factory"
                  },
                  "___17"
                ]
              ],
              [
                "___19",
                [
                  "__builtin_list__",
                  {
                    "str": "loop_index_tuple_expr"
                  },
                  "loop_index_tuple_expr"
                ]
              ],
              [
                "___20",
                [
                  "__builtin_list__",
                  {
                    "str": "threadIdx.x"
                  }
                ]
              ],
              [
                "___21",
                [
                  "__builtin_list__",
                  {
                    "str": "loop_var_names"
                  },
                  "___20"
                ]
              ],
              [
                "___22",
                [
                  "__builtin_list__",
                  "___18",
                  "___19",
                  "___21"
                ]
              ],
              [
                "___23",
                [
                  "__builtin_list__"
                ]
              ],
              [
                "___24",
                [
                  "__builtin_PackedArgs__",
                  "___23",
                  "___22"
                ]
              ],
              [
                "___25",
                [
                  "___16",
                  "___24"
                ]
              ],
              [
                "fusion_code_gen",
                [
                  "__builtin_identity__",
                  "___25"
                ]
              ],
              [
                "___26",
                [
                  "__builtin_getattr__",
                  "self",
                  {
                    "str": "lir_code_gen_ctx_class"
                  }
                ]
              ],
              [
                "___27",
                [
                  "___26"
                ]
              ],
              [
                "lir_code_gen_ctx",
                [
                  "__builtin_identity__",
                  "___27"
                ]
              ],
              [
                "___28",
                [
                  "__builtin_getattr__",
                  "fusion_code_gen",
                  {
                    "str": "load_from_register"
                  }
                ]
              ],
              [
                "___29",
                [
                  "___28",
                  "lir_code_gen_ctx",
                  {
                    "str": "x"
                  },
                  0
                ]
              ],
              [
                "values",
                [
                  "__builtin_identity__",
                  "___29"
                ]
              ],
              [
                "___30",
                [
                  "__builtin_getattr__",
                  "fusion_code_gen",
                  {
                    "str": "compute"
                  }
                ]
              ],
              [
                "___31",
                [
                  "___30",
                  "lir_code_gen_ctx",
                  "values"
                ]
              ],
              [
                "values",
                [
                  "__builtin_identity__",
                  "___31"
                ]
              ],
              [
                "___32",
                [
                  "__builtin_getattr__",
                  "fusion_code_gen",
                  {
                    "str": "store_to_register"
                  }
                ]
              ],
              [
                "___33",
                [
                  "___32",
                  "lir_code_gen_ctx",
                  "values",
                  {
                    "str": "y"
                  },
                  0
                ]
              ],
              [
                "values",
                [
                  "__builtin_identity__",
                  "___33"
                ]
              ],
              [
                "___34",
                [
                  "print",
                  {
                    "str": "==================================="
                  }
                ]
              ],
              [
                "___35",
                [
                  "__builtin_identity__",
                  "___34"
                ]
              ],
              [
                "___36",
                [
                  "print",
                  {
                    "str": "fusion_code_gen.compute(): "
                  },
                  "values"
                ]
              ],
              [
                "___37",
                [
                  "__builtin_identity__",
                  "___36"
                ]
              ],
              [
                "___38",
                [
                  "__builtin_getattr__",
                  "lir_code_gen_ctx",
                  {
                    "str": "get_stmts_joined_str"
                  }
                ]
              ],
              [
                "___39",
                [
                  "___38"
                ]
              ],
              [
                "___40",
                [
                  "print",
                  {
                    "str": "low level ir of fusion_op:\n"
                  },
                  "___39"
                ]
              ],
              [
                "___41",
                [
                  "__builtin_identity__",
                  "___40"
                ]
              ],
              [
                "___42",
                [
                  "print",
                  {
                    "str": "==================================="
                  }
                ]
              ],
              [
                "___43",
                [
                  "__builtin_identity__",
                  "___42"
                ]
              ],
              [
                "___44",
                [
                  "__builtin_getattr__",
                  "lir_code_gen_ctx",
                  {
                    "str": "get_stmts_joined_str"
                  }
                ]
              ],
              [
                "___45",
                [
                  "___44"
                ]
              ],
              [
                "trivial_code_str",
                [
                  "__builtin_identity__",
                  "___45"
                ]
              ],
              [
                "___46",
                [
                  "__builtin_getattr__",
                  "self",
                  {
                    "str": "make_project"
                  }
                ]
              ],
              [
                "___47",
                [
                  "___46",
                  "trivial_code_str"
                ]
              ],
              [
                "project_module",
                [
                  "__builtin_identity__",
                  "___47"
                ]
              ],
              [
                "___48",
                [
                  "__builtin_list__",
                  {
                    "str": "module"
                  },
                  "project_module"
                ]
              ],
              [
                "___49",
                [
                  "__builtin_list__",
                  {
                    "str": "kernel_dispatch_func"
                  },
                  "KernelDispatch"
                ]
              ],
              [
                "___50",
                [
                  "__builtin_getattr__",
                  "dim0_karg",
                  {
                    "str": "runtime_getter"
                  }
                ]
              ],
              [
                "___51",
                [
                  "__builtin_getattr__",
                  "input_karg",
                  {
                    "str": "runtime_getter"
                  }
                ]
              ],
              [
                "___52",
                [
                  "__builtin_getattr__",
                  "output_karg",
                  {
                    "str": "runtime_getter"
                  }
                ]
              ],
              [
                "___53",
                [
                  "__builtin_list__",
                  "___50",
                  "___51",
                  "___52"
                ]
              ],
              [
                "___54",
                [
                  "__builtin_list__",
                  {
                    "str": "kernel_args_getters"
                  },
                  "___53"
                ]
              ],
              [
                "___55",
                [
                  "__builtin_list__",
                  "___54"
                ]
              ],
              [
                "___56",
                [
                  "__builtin_list__"
                ]
              ],
              [
                "___57",
                [
                  "__builtin_PackedArgs__",
                  "___56",
                  "___55"
                ]
              ],
              [
                "___58",
                [
                  "BuiltinSerializableAttrMap",
                  "___57"
                ]
              ],
              [
                "___59",
                [
                  "__builtin_list__",
                  {
                    "str": "kernel_dispatch_const_data"
                  },
                  "___58"
                ]
              ],
              [
                "___60",
                [
                  "__builtin_list__",
                  "___48",
                  "___49",
                  "___59"
                ]
              ],
              [
                "___61",
                [
                  "__builtin_list__"
                ]
              ],
              [
                "___62",
                [
                  "__builtin_PackedArgs__",
                  "___61",
                  "___60"
                ]
              ],
              [
                "___63",
                [
                  "CodeGenResult",
                  "___62"
                ]
              ],
              [
                "___64",
                [
                  "__builtin_return__",
                  "___63"
                ]
              ]
            ],
            [
              "__builtin_identity__",
              null
            ]
          ]
        ]
      ]
    ],
    [
      "___65",
      [
        "__builtin_getattr__",
        "compile",
        {
          "str": "__function__"
        }
      ]
    ],
    [
      "___66",
      [
        "__builtin_list__",
        {
          "str": "compile"
        },
        "___65"
      ]
    ],
    [
      "make_project",
      [
        "__builtin_identity__",
        [
          "lambda",
          [
            "self",
            "trivial_code_str"
          ],
          [
            "__builtin_let__",
            [
              [
                "code_template",
                [
                  "__builtin_identity__",
                  {
                    "str": "\n#include <cstdint>\n#include <iostream>\n#define CINN_WITH_CUDA\n\nextern \"C\" __global__\nvoid trivial_reduce(const int64_t num, const float* input, float* output) {\n  int idx = blockIdx.x * blockDim.x + threadIdx.x;\n  __shared__ float buf[1024];\n  float y;\n  if (idx < num) {\n    float x = input[idx];\n    TRIVIAL_CODE_STRING;\n    buf[idx] = y;\n  }\n  __syncthreads();\n  if (idx==0) {\n    for (int i = 1; i < num; ++i) {\n      buf[0] += buf[i];\n    }\n    output[0] = buf[0];\n  }\n}\n\nextern \"C\"\nvoid api_trivial_reduce(void* stream_ptr, const int64_t num, const float* input, float* output) {\n  std::cout << \"stream_ptr: \" << stream_ptr << std::endl;\n  cudaStream_t stream = *(cudaStream_t*)(stream_ptr);\n  std::cout << \"yiqun nice\" << std::endl;\n  std::cout << \"num: \" << num << std::endl;\n  std::cout << \"input: \" << input << std::endl;\n  std::cout << \"output: \" << output << std::endl;\n  return trivial_reduce<<<1, num, 0, stream>>>(num, input, output);\n}\n\n  "
                  }
                ]
              ],
              [
                "___67",
                [
                  "__builtin_getattr__",
                  "code_template",
                  {
                    "str": "replace"
                  }
                ]
              ],
              [
                "___68",
                [
                  "___67",
                  {
                    "str": "TRIVIAL_CODE_STRING"
                  },
                  "trivial_code_str"
                ]
              ],
              [
                "code",
                [
                  "__builtin_identity__",
                  "___68"
                ]
              ],
              [
                "compile_cmd",
                [
                  "__builtin_identity__",
                  {
                    "str": "nvcc --ptxas-options=-v --compiler-options '-fPIC' --shared  trivial_reduce.cu -o libtrivial_reduce.so"
                  }
                ]
              ],
              [
                "___69",
                [
                  "__builtin_getattr__",
                  "DataType",
                  {
                    "str": "void"
                  }
                ]
              ],
              [
                "___70",
                [
                  "__builtin_getattr__",
                  "PointerType",
                  {
                    "str": "void_ptr"
                  }
                ]
              ],
              [
                "___71",
                [
                  "__builtin_getattr__",
                  "DataType",
                  {
                    "str": "const_int64"
                  }
                ]
              ],
              [
                "___72",
                [
                  "__builtin_getattr__",
                  "PointerType",
                  {
                    "str": "const_float_ptr"
                  }
                ]
              ],
              [
                "___73",
                [
                  "__builtin_getattr__",
                  "PointerType",
                  {
                    "str": "float_ptr"
                  }
                ]
              ],
              [
                "___74",
                [
                  "__builtin_list__",
                  "___70",
                  "___71",
                  "___72",
                  "___73"
                ]
              ],
              [
                "___75",
                [
                  "FuncDeclare",
                  "___69",
                  {
                    "str": "api_trivial_reduce"
                  },
                  "___74"
                ]
              ],
              [
                "___76",
                [
                  "__builtin_getattr__",
                  "Project",
                  {
                    "str": "Directory"
                  }
                ]
              ],
              [
                "___77",
                [
                  "__builtin_getattr__",
                  "Project",
                  {
                    "str": "FileContent"
                  }
                ]
              ],
              [
                "___78",
                [
                  "___77",
                  "code"
                ]
              ],
              [
                "___79",
                [
                  "__builtin_list__",
                  {
                    "str": "trivial_reduce.cu"
                  },
                  "___78"
                ]
              ],
              [
                "___80",
                [
                  "__builtin_getattr__",
                  "Project",
                  {
                    "str": "FileContent"
                  }
                ]
              ],
              [
                "___81",
                [
                  "___80",
                  "compile_cmd"
                ]
              ],
              [
                "___82",
                [
                  "__builtin_list__",
                  {
                    "str": "make.sh"
                  },
                  "___81"
                ]
              ],
              [
                "___83",
                [
                  "___76",
                  "___79",
                  "___82"
                ]
              ],
              [
                "___84",
                [
                  "__builtin_list__",
                  {
                    "str": "nested_files"
                  },
                  "___83"
                ]
              ],
              [
                "___85",
                [
                  "__builtin_list__",
                  {
                    "str": "compile_cmd"
                  },
                  {
                    "str": "sh make.sh"
                  }
                ]
              ],
              [
                "___86",
                [
                  "__builtin_list__",
                  {
                    "str": "so_relative_path"
                  },
                  {
                    "str": "libtrivial_reduce.so"
                  }
                ]
              ],
              [
                "___87",
                [
                  "__builtin_list__",
                  "___84",
                  "___85",
                  "___86"
                ]
              ],
              [
                "___88",
                [
                  "__builtin_list__"
                ]
              ],
              [
                "___89",
                [
                  "__builtin_PackedArgs__",
                  "___88",
                  "___87"
                ]
              ],
              [
                "___90",
                [
                  "Project",
                  "___89"
                ]
              ],
              [
                "___91",
                [
                  "CodeModule",
                  "___75",
                  "___90"
                ]
              ],
              [
                "___92",
                [
                  "__builtin_return__",
                  "___91"
                ]
              ]
            ],
            [
              "__builtin_identity__",
              null
            ]
          ]
        ]
      ]
    ],
    [
      "___93",
      [
        "__builtin_getattr__",
        "make_project",
        {
          "str": "__function__"
        }
      ]
    ],
    [
      "___94",
      [
        "__builtin_list__",
        {
          "str": "make_project"
        },
        "___93"
      ]
    ],
    [
      "___95",
      [
        "__builtin_list__"
      ]
    ],
    [
      "___96",
      [
        "__builtin_list__",
        "___11",
        "___66",
        "___94"
      ]
    ],
    [
      "___97",
      [
        "__builtin_PackedArgs__",
        "___95",
        "___96"
      ]
    ],
    [
      "___98",
      [
        "BuiltinSerializableAttrMap",
        "___97"
      ]
    ],
    [
      "___99",
      [
        "type",
        {
          "str": "TrivialReduceTemplate"
        },
        "___0",
        "___98"
      ]
    ],
    [
      "TrivialReduceTemplate",
      [
        "__builtin_identity__",
        "___99"
      ]
    ],
    [
      "KernelDispatch",
      [
        "__builtin_identity__",
        [
          "lambda",
          [
            "ctx"
          ],
          [
            "__builtin_let__",
            [
              [
                "___100",
                [
                  "__builtin_getattr__",
                  "ctx",
                  {
                    "str": "get_so_function"
                  }
                ]
              ],
              [
                "___101",
                [
                  "___100",
                  {
                    "str": "api_trivial_reduce"
                  }
                ]
              ],
              [
                "so_func",
                [
                  "__builtin_identity__",
                  "___101"
                ]
              ],
              [
                "___103",
                [
                  "__builtin_getattr__",
                  "ctx",
                  {
                    "str": "kernel_dispatch_const_data"
                  }
                ]
              ],
              [
                "___102",
                [
                  "__builtin_getattr__",
                  "___103",
                  {
                    "str": "kernel_args_getters"
                  }
                ]
              ],
              [
                "getters",
                [
                  "__builtin_identity__",
                  "___102"
                ]
              ],
              [
                "___105",
                [
                  "__builtin_getattr__",
                  "ctx",
                  {
                    "str": "device_ctx"
                  }
                ]
              ],
              [
                "___104",
                [
                  "__builtin_getattr__",
                  "___105",
                  {
                    "str": "get_stream_addr_as_void_ptr"
                  }
                ]
              ],
              [
                "___106",
                [
                  "___104"
                ]
              ],
              [
                "stream_ptr",
                [
                  "__builtin_identity__",
                  "___106"
                ]
              ],
              [
                "___107",
                [
                  "print",
                  {
                    "str": "stream_ptr:"
                  },
                  "stream_ptr"
                ]
              ],
              [
                "___108",
                [
                  "__builtin_identity__",
                  "___107"
                ]
              ],
              [
                "___109",
                [
                  "__builtin_getitem__",
                  "getters",
                  0
                ]
              ],
              [
                "___110",
                [
                  "___109",
                  "ctx"
                ]
              ],
              [
                "___111",
                [
                  "print",
                  {
                    "str": "getters[0](ctx):"
                  },
                  "___110"
                ]
              ],
              [
                "___112",
                [
                  "__builtin_identity__",
                  "___111"
                ]
              ],
              [
                "___113",
                [
                  "__builtin_getitem__",
                  "getters",
                  1
                ]
              ],
              [
                "___114",
                [
                  "___113",
                  "ctx"
                ]
              ],
              [
                "___115",
                [
                  "print",
                  {
                    "str": "getters[1](ctx):"
                  },
                  "___114"
                ]
              ],
              [
                "___116",
                [
                  "__builtin_identity__",
                  "___115"
                ]
              ],
              [
                "___117",
                [
                  "__builtin_getitem__",
                  "getters",
                  2
                ]
              ],
              [
                "___118",
                [
                  "___117",
                  "ctx"
                ]
              ],
              [
                "___119",
                [
                  "print",
                  {
                    "str": "getters[2](ctx):"
                  },
                  "___118"
                ]
              ],
              [
                "___120",
                [
                  "__builtin_identity__",
                  "___119"
                ]
              ],
              [
                "___121",
                [
                  "__builtin_getitem__",
                  "getters",
                  0
                ]
              ],
              [
                "___122",
                [
                  "___121",
                  "ctx"
                ]
              ],
              [
                "___123",
                [
                  "__builtin_getitem__",
                  "getters",
                  1
                ]
              ],
              [
                "___124",
                [
                  "___123",
                  "ctx"
                ]
              ],
              [
                "___125",
                [
                  "__builtin_getitem__",
                  "getters",
                  2
                ]
              ],
              [
                "___126",
                [
                  "___125",
                  "ctx"
                ]
              ],
              [
                "___127",
                [
                  "so_func",
                  "stream_ptr",
                  "___122",
                  "___124",
                  "___126"
                ]
              ],
              [
                "___128",
                [
                  "__builtin_identity__",
                  "___127"
                ]
              ]
            ],
            [
              "__builtin_identity__",
              null
            ]
          ]
        ]
      ]
    ]
  ],
  [
    "__builtin_identity__",
    "KernelDispatch"
  ]
]